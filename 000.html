<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>å°æµ‹è¯•</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 30px; background: #f4f6f9; color:#222; }
    h1 { color: #2a2a2a; margin-bottom: 12px; }
    .card { border: 1px solid #ccc; padding: 20px; margin: 20px auto; width: 92%; max-width: 960px;
            border-radius: 12px; background: #fff; box-shadow: 0 4px 12px rgba(0,0,0,.06); }
    .word-row { display:flex; flex-wrap:wrap; justify-content:center; gap:10px; }
    .word-block { display:flex; align-items:center; }
    .word-input { width: 150px; padding: 8px 10px; font-size: 18px; text-align: center;
                  border: 1px solid #d0d7de; border-radius: 8px; outline: none; }
    .word-input:focus { box-shadow: 0 0 0 3px rgba(51,136,255,.18); border-color: #3388ff; }
    .punct { font-size:20px; font-weight:700; margin-left:4px; color:#444; }
    .correct { background: #c8f7c5; border: 1px solid #47a447 !important; }
    .wrong { background: #f8d7da; border: 1px solid #f44336 !important; color: #b00020; font-weight: bold; }
    .answer-box { margin: 18px auto 0; padding: 16px; border-radius: 10px; background: #eef3fc; width:92%; max-width: 960px;
                  box-shadow: inset 0 0 6px rgba(0,0,0,0.06); text-align:left; }
    .answer-box .row { margin:6px 0; }
    .label { display:inline-block; min-width:92px; color:#555; }
    .ru { font-size: 22px; font-weight: 700; color: #003366; }
    .btn { padding:10px 18px; margin:8px; border:1px solid #aaa; border-radius:8px; background:#f0f3f7; cursor:pointer; font-size:18px; }
    .btn:hover { background:#e6ebf2; }
    .muted { color:#666; font-size:14px; margin:10px 0 18px; }
    .notice { color:#b00020; font-size:14px; margin:6px 0 18px; }
  </style>
</head>
<body>
  <h1>ğŸ“– å°æµ‹è¯•</h1>
  <p class="muted">
    è¾“å…¥å•è¯åæŒ‰ç©ºæ ¼/å›è½¦åˆ¤å®š â†’ æœ¬é¡µå…¨éƒ¨å®Œæˆå â†’ å†æŒ‰ç©ºæ ¼æ˜¾ç¤ºç­”æ¡ˆ â†’ å†æŒ‰ç©ºæ ¼è¿›å…¥ä¸‹ä¸€é¡µã€‚<br>
    å›é€€ï¼šåœ¨è¯ç»„/å¥å­é¡µï¼Œ<b>Backspace</b>ï¼ˆå…‰æ ‡åœ¨æœ€å‰æˆ–è¾“å…¥ä¸ºç©ºï¼‰å¯å›åˆ°ä¸Šä¸€ä¸ªè¯ã€‚<br>
    æœ—è¯»ï¼šç”µè„‘ç«¯è¾“å…¥åè‡ªåŠ¨æœ—è¯»ï¼›æ‰‹æœº/å¹³æ¿éœ€ç‚¹ ğŸ”Šã€‚<br>
    è·³è¿‡ï¼šç‚¹â¡ï¸ ä¸‹ä¸€é¡µï¼ˆæœªæ˜¾ç¤ºç­”æ¡ˆâ†’å…ˆæ˜¾ç¤ºï¼›å·²æ˜¾ç¤ºâ†’ä¸‹ä¸€é¡µï¼‰ã€‚
  </p>
  <p class="notice">ğŸ“± æ‰‹æœº/å¹³æ¿ï¼šå¦‚ç‚¹ğŸ”Šæ²¡å£°éŸ³ï¼Œè¯·å†ç‚¹å‡»ä¸€æ¬¡ï¼ˆç³»ç»Ÿé™åˆ¶ï¼‰ã€‚</p>

  <div class="card">
    <div id="cn" style="font-size:18px; margin-bottom:12px;"></div>
    <div id="inputs" class="word-row"></div>
    <div class="controls" style="margin-top:8px;">
      <button class="btn" id="speakBtn">ğŸ”Š æ’­æ”¾/æš‚åœ</button>
      <button class="btn" id="nextBtn">â¡ï¸ ä¸‹ä¸€é¡µ</button>
    </div>
  </div>

  <div id="answer" class="answer-box" style="display:none;">
    <div class="row"><span class="label">ä¿„è¯­ï¼š</span><span id="ru" class="ru"></span></div>
    <div class="row"><span class="label">é‡éŸ³ï¼š</span><span id="phon"></span></div>
    <div class="row"><span class="label">è¯æ€§/è¯­æ³•ï¼š</span><span id="pos"></span></div>
    <div class="row"><span class="label">ä¸­æ–‡ï¼š</span><span id="cnAnswer"></span></div>
  </div>

  <script>
  const pages = [
    { cn:"æ¶²å‹åˆ†é…å™¨ï¼ˆç¬¬ä¸€æ ¼ï¼‰", ru:"Ğ“Ğ¸Ğ´Ñ€Ğ¾Ñ€Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ĞµĞ»ÑŒ", phon:"Ğ“Ğ¸Ğ´Ñ€Ğ¾Ñ€Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸ÌÑ‚ĞµĞ»ÑŒ", pos:"åè¯ Â· ç¬¬ä¸€æ ¼", type:"word" },
    { cn:"ç”¨äºï¼ˆçŸ­å°¾å½¢ï¼‰", ru:"Ğ¿Ñ€ĞµĞ´Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½", phon:"Ğ¿Ñ€ĞµĞ´Ğ½Ğ°Ğ·Ğ½Ğ°ÌÑ‡ĞµĞ½", pos:"çŸ­å°¾å½¢", type:"word" },
    { cn:"â€˜æ§åˆ¶â€™ï¼ˆç¬¬ä¸€æ ¼ï¼‰", ru:"ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ", phon:"ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµÌĞ½Ğ¸Ğµ", pos:"åè¯ Â· ç¬¬ä¸€æ ¼", type:"word" },
    { cn:"â€˜æ§åˆ¶â€™ï¼ˆäºŒæ ¼å•ï¼‰", ru:"ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ", phon:"ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµÌĞ½Ğ¸Ñ", pos:"åè¯ Â· äºŒæ ¼å•", type:"word" },
    { cn:"æµåŠ¨ï¼ˆç¬¬ä¸€æ ¼ï¼‰", ru:"Ğ¿Ğ¾Ñ‚Ğ¾Ğº", phon:"Ğ¿Ğ¾Ñ‚Ğ¾ÌĞº", pos:"åè¯ Â· ç¬¬ä¸€æ ¼", type:"word" },
    { cn:"æµåŠ¨ï¼ˆå·¥å…·æ ¼å¤ï¼‰", ru:"Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ°Ğ¼Ğ¸", phon:"Ğ¿Ğ¾Ñ‚Ğ¾ÌĞºĞ°Ğ¼Ğ¸", pos:"åè¯ Â· å·¥å…·æ ¼å¤", type:"word" },
    { cn:"å·¥ä½œæ¶²ä½“ï¼ˆè¯ç»„ï¼Œä¸€æ ¼ï¼‰", ru:"Ñ€Ğ°Ğ±Ğ¾Ñ‡Ğ°Ñ Ğ¶Ğ¸Ğ´ĞºĞ¾ÑÑ‚ÑŒ", phon:"Ñ€Ğ°Ğ±Ğ¾ÌÑ‡Ğ°Ñ Ğ¶Ğ¸ÌĞ´ĞºĞ¾ÑÑ‚ÑŒ", pos:"åè¯çŸ­è¯­ Â· ä¸€æ ¼", type:"phrase" },
    { cn:"å·¥ä½œæ¶²ä½“ï¼ˆè¯ç»„ï¼ŒäºŒæ ¼ï¼‰", ru:"Ñ€Ğ°Ğ±Ğ¾Ñ‡ĞµĞ¹ Ğ¶Ğ¸Ğ´ĞºĞ¾ÑÑ‚Ğ¸", phon:"Ñ€Ğ°Ğ±Ğ¾ÌÑ‡ĞµĞ¹ Ğ¶Ğ¸ÌĞ´ĞºĞ¾ÑÑ‚Ğ¸", pos:"åè¯çŸ­è¯­ Â· äºŒæ ¼", type:"phrase" },
    { cn:"æ¶²å‹ç³»ç»Ÿï¼ˆç¬¬ä¸€æ ¼ï¼‰", ru:"Ğ³Ğ¸Ğ´Ñ€Ğ¾ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°", phon:"Ğ³Ğ¸Ğ´Ñ€Ğ¾ÑĞ¸ÑÑ‚ĞµÌĞ¼Ğ°", pos:"åè¯ Â· ç¬¬ä¸€æ ¼", type:"word" },
    { cn:"æ¶²å‹ç³»ç»Ÿï¼ˆå‰ç½®æ ¼ï¼‰", ru:"Ğ³Ğ¸Ğ´Ñ€Ğ¾ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ", phon:"Ğ³Ğ¸Ğ´Ñ€Ğ¾ÑĞ¸ÑÑ‚ĞµÌĞ¼Ğµ", pos:"åè¯ Â· å‰ç½®æ ¼", type:"word" },
    { cn:"æ•´å¥ï¼šæ¶²å‹åˆ†é…å™¨ç”¨äºæ§åˆ¶æ¶²å‹ç³»ç»Ÿä¸­å·¥ä½œæ¶²ä½“çš„æµåŠ¨ã€‚",
      ru:"Ğ“Ğ¸Ğ´Ñ€Ğ¾Ñ€Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ĞµĞ»ÑŒ Ğ¿Ñ€ĞµĞ´Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½ Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ°Ğ¼Ğ¸ Ñ€Ğ°Ğ±Ğ¾Ñ‡ĞµĞ¹ Ğ¶Ğ¸Ğ´ĞºĞ¾ÑÑ‚Ğ¸ Ğ² Ğ³Ğ¸Ğ´Ñ€Ğ¾ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ.",
      phon:"Ğ“Ğ¸Ğ´Ñ€Ğ¾Ñ€Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸ÌÑ‚ĞµĞ»ÑŒ Ğ¿Ñ€ĞµĞ´Ğ½Ğ°Ğ·Ğ½Ğ°ÌÑ‡ĞµĞ½ Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµÌĞ½Ğ¸Ñ Ğ¿Ğ¾Ñ‚Ğ¾ÌĞºĞ°Ğ¼Ğ¸ Ñ€Ğ°Ğ±Ğ¾ÌÑ‡ĞµĞ¹ Ğ¶Ğ¸ÌĞ´ĞºĞ¾ÑÑ‚Ğ¸ Ğ² Ğ³Ğ¸Ğ´Ñ€Ğ¾ÑĞ¸ÑÑ‚ĞµÌĞ¼Ğµ.",
      pos:"æ•´å¥", type:"sentence" },

    { cn:"ç”±â€¦ç»„æˆï¼ˆä¸å®šå¼ï¼‰", ru:"ÑĞ¾ÑÑ‚Ğ¾ÑÑ‚ÑŒ", phon:"ÑĞ¾ÑÑ‚Ğ¾ÑÌÑ‚ÑŒ", pos:"åŠ¨è¯ Â· ä¸å®šå¼", type:"word" },
    { cn:"ç”±â€¦ç»„æˆï¼ˆ3å•ï¼‰", ru:"ÑĞ¾ÑÑ‚Ğ¾Ğ¸Ñ‚", phon:"ÑĞ¾ÑÑ‚Ğ¾Ğ¸ÌÑ‚", pos:"åŠ¨è¯ Â· 3å•", type:"word" },
    { cn:"å‡ ä¸ªï¼ˆæ•°é‡è¯Â·åŸºæœ¬å½¢ï¼‰", ru:"Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾", phon:"Ğ½ĞµÌÑĞºĞ¾Ğ»ÑŒĞºĞ¾", pos:"æ•°é‡è¯ Â· åŸºæœ¬å½¢", type:"word" },
    { cn:"å‡ ä¸ªï¼ˆå±æ ¼å¤ï¼‰", ru:"Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ñ…", phon:"Ğ½ĞµÌÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ñ…", pos:"æ•°é‡è¯ Â· å±æ ¼å¤", type:"word" },
    { cn:"é˜€ç‰‡ï¼ˆç¬¬ä¸€æ ¼ é˜´ï¼‰", ru:"ÑĞµĞºÑ†Ğ¸Ñ", phon:"ÑĞµÌĞºÑ†Ğ¸Ñ", pos:"åè¯ Â· ç¬¬ä¸€æ ¼ é˜´", type:"word" },
    { cn:"é˜€ç‰‡ï¼ˆäºŒæ ¼å¤ é˜´ï¼‰", ru:"ÑĞµĞºÑ†Ğ¸Ğ¹", phon:"ÑĞµÌĞºÑ†Ğ¸Ğ¹", pos:"åè¯ Â· äºŒæ ¼å¤ é˜´", type:"word" },
    { cn:"æ‰§è¡Œæœºæ„ï¼ˆè¯ç»„ï¼Œä¸€æ ¼/å››æ ¼ï¼‰", ru:"Ğ¸ÑĞ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¼ĞµÑ…Ğ°Ğ½Ğ¸Ğ·Ğ¼", phon:"Ğ¸ÑĞ¿Ğ¾Ğ»Ğ½Ğ¸ÌÑ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¼ĞµÑ…Ğ°Ğ½Ğ¸ÌĞ·Ğ¼", pos:"è¯ç»„ Â· ä¸€æ ¼/å››æ ¼", type:"phrase" },
    { cn:"æ•´å¥ï¼šå®ƒç”±è‹¥å¹²é˜€ç‰‡ç»„æˆï¼Œæ¯ä¸€ä¸ªé˜€ç‰‡è´Ÿè´£ä¸€ä¸ªæ‰§è¡Œæœºæ„ã€‚",
      ru:"ĞĞ½ ÑĞ¾ÑÑ‚Ğ¾Ğ¸Ñ‚ Ğ¸Ğ· Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ñ… ÑĞµĞºÑ†Ğ¸Ğ¹, ĞºĞ°Ğ¶Ğ´Ğ°Ñ Ğ¸Ğ· ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ñ… Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°ĞµÑ‚ Ğ·Ğ° Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¸ÑĞ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¼ĞµÑ…Ğ°Ğ½Ğ¸Ğ·Ğ¼.",
      phon:"ĞĞ½ ÑĞ¾ÑÑ‚Ğ¾Ğ¸ÌÑ‚ Ğ¸Ğ· Ğ½ĞµÌÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ñ… ÑĞµÌĞºÑ†Ğ¸Ğ¹, ĞºĞ°ÌĞ¶Ğ´Ğ°Ñ Ğ¸Ğ· ĞºĞ¾Ñ‚Ğ¾ÌÑ€Ñ‹Ñ… Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°ÌĞµÑ‚ Ğ·Ğ° Ğ¾Ñ‚Ğ´ĞµÌĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¸ÑĞ¿Ğ¾Ğ»Ğ½Ğ¸ÌÑ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¼ĞµÑ…Ğ°Ğ½Ğ¸ÌĞ·Ğ¼.",
      pos:"æ•´å¥", type:"sentence" }
  ];

  let idx=0, showingAnswer=false, pageComplete=false;
  let ruVoice=null, speaking=false, audioUnlocked=false, loopTimer=null;
  const isMobile=/Mobi|Android|iPad|iPhone/i.test(navigator.userAgent);

  function pickRuVoice(){const v=speechSynthesis.getVoices(); ruVoice=v.find(x=>x.lang.toLowerCase().startsWith('ru'))||null;}
  pickRuVoice(); speechSynthesis.onvoiceschanged=pickRuVoice;

  function stopSpeak(){ clearTimeout(loopTimer); speechSynthesis.cancel(); }
  function speak(text){ if(!audioUnlocked||!speaking) return;
    stopSpeak(); const u=new SpeechSynthesisUtterance(text);
    if(ruVoice) u.voice=ruVoice; u.lang="ru-RU"; u.rate=0.7;
    u.onend=()=>{ if(speaking && !isMobile) loopTimer=setTimeout(()=>speak(text),1200); };
    speechSynthesis.speak(u);
  }

  // æ‰“å­—æœºéŸ³æ•ˆ
  let audioCtx;
  function ensureAudioCtx(){ if(!audioCtx){ const AC=window.AudioContext||window.webkitAudioContext; audioCtx=new AC(); } if(audioCtx.state==='suspended') audioCtx.resume(); }
  function keyClick(){ ensureAudioCtx(); const osc=audioCtx.createOscillator(), gain=audioCtx.createGain();
    osc.type="triangle"; osc.frequency.setValueAtTime(2200, audioCtx.currentTime);
    gain.gain.setValueAtTime(0.015, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime+0.05);
    osc.connect(gain).connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime+0.05); }

  function normalize(s){ return (s||"").toLowerCase().replace(/[.,!?;:â€”â€“â€¦Â«Â»"()]/g,""); }
  function recomputePageComplete(){ const inputs=document.querySelectorAll('#inputs input.word-input'); pageComplete=Array.from(inputs).every(i=>i.classList.contains('done')); }
  function focusNextNotDone(cur){ const all=Array.from(document.querySelectorAll('#inputs input.word-input')); const i=all.indexOf(cur);
    for(let j=i+1;j<all.length;j++){ if(!all[j].classList.contains('done')){ all[j].focus(); return; } } }

  function attachInputHandlers(inp, fullText, allowBack=false){
    inp.addEventListener('input',()=>{ keyClick(); if(!audioUnlocked) audioUnlocked=true; if(!isMobile && !speaking){ speaking=true; speak(fullText); } });
    inp.addEventListener('keydown',(e)=>{
      if(e.key.length===1||e.key===' ') keyClick();
      if(e.key===' '||e.key==='Enter'){ e.preventDefault();
        inp.classList.add('done'); const ok=normalize(inp.value)===normalize(inp.dataset.correct);
        inp.classList.toggle('correct',ok); inp.classList.toggle('wrong',!ok);
        recomputePageComplete(); if(!pageComplete) focusNextNotDone(inp); return; }
    });
  }

  function renderPage(){
    stopSpeak(); showingAnswer=false; pageComplete=false;
    document.getElementById('answer').style.display='none';
    const p=pages[idx]; document.getElementById('cn').textContent="ä¸­æ–‡æç¤ºï¼š"+p.cn;
    const inputsDiv=document.getElementById('inputs'); inputsDiv.innerHTML="";
    const tokenRegex=/^(.+?)([.,!?;:â€”â€“â€¦Â«Â»"()]*)$/;
    const tokens=p.ru.trim().split(/\s+/);
    tokens.forEach(w=>{
      const block=document.createElement("div"); block.className="word-block";
      const inp=document.createElement("input"); inp.type="text"; inp.className="word-input";
      let base=w,punct=""; const m=w.match(tokenRegex); if(m){ base=m[1]; punct=m[2]; }
      inp.dataset.correct=base; attachInputHandlers(inp,p.ru,true);
      block.appendChild(inp); if(punct){ const span=document.createElement("span"); span.className="punct"; span.textContent=punct; block.appendChild(span); }
      inputsDiv.appendChild(block);
    });
    const first=inputsDiv.querySelector('input.word-input'); if(first) first.focus();
    if(!isMobile&&audioUnlocked&&speaking) speak(p.ru);
  }

  function showAnswer(){ const p=pages[idx]; document.getElementById('ru').textContent=p.ru; document.getElementById('phon').textContent=p.phon||""; document.getElementById('pos').textContent=p.pos||""; document.getElementById('cnAnswer').textContent=p.cn||""; document.getElementById('answer').style.display='block'; showingAnswer=true; }
  
  function nextPage(){
    if(idx === pages.length - 1){
      stopSpeak();
      document.getElementById('inputs').innerHTML = "";
      document.getElementById('cn').textContent = "ğŸ‰ æ­å–œï¼æ‚¨å·²å®Œæˆæ‰€æœ‰æµ‹è¯•ã€‚";
      document.getElementById('answer').style.display = "none";
      document.getElementById('speakBtn').style.display = "none";
      document.getElementById('nextBtn').style.display = "none";
    } else {
      idx++;
      renderPage();
    }
  }

  document.addEventListener('keydown',(e)=>{ if(e.key===' '||e.key==='Enter'){ if(!showingAnswer&&pageComplete){ e.preventDefault(); showAnswer(); } else if(showingAnswer){ e.preventDefault(); nextPage(); } } });
  document.getElementById('speakBtn').onclick=()=>{ if(!audioUnlocked){ audioUnlocked=true; const init=new SpeechSynthesisUtterance("Ñ‚ĞµÑÑ‚"); init.lang="ru-RU"; speechSynthesis.speak(init); }
    if(speaking){ speaking=false; stopSpeak(); } else { speaking=true; speak(pages[idx].ru); } };
  document.getElementById('nextBtn').onclick=()=>{ if(!showingAnswer){ showAnswer(); } else { nextPage(); } };

  renderPage();
  </script>
</body>
</html>