<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>å°æµ‹è¯•</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 40px; background: #f4f6f9; }
    h1 { color: #333; }
    .card { border: 1px solid #ccc; padding: 20px; margin: 20px auto; width: 90%; max-width: 860px;
            border-radius: 12px; background: #fff; box-shadow: 0 4px 10px rgba(0,0,0,.08); }
    .word-input { width: 90%; max-width: 700px; padding: 12px 14px; font-size: 20px; text-align: center;
                  margin: 12px auto; border-radius: 8px; border: 1px solid #d0d7de; outline: none; }
    .word-input:focus { box-shadow: 0 0 0 3px rgba(51,136,255,.18); border-color: #3388ff; }
    .correct { background: #c8f7c5; border: 1px solid #4caf50 !important; }
    .wrong { background: #f8d7da; border: 1px solid #f44336 !important; }
    .answer-box { margin-top: 16px; padding: 18px; border-radius: 10px; background: #eef3fc;
                  box-shadow: inset 0 0 6px rgba(0,0,0,0.06); }
    .ru { font-size: 22px; font-weight: 700; color: #003366; }
    .phon, .pos, .cn { font-size: 18px; color: #333; margin-top: 6px; }
    .muted { color: #777; font-size: 14px; margin-top: 10px; }
    .pill { display:inline-block; padding: 3px 10px; border-radius: 999px; background:#f0f3f7; color:#4a5568; font-size:12px; margin:0 4px;}
    .tip { color:#888; font-size:14px; }
    .controls { margin-top: 12px; }
    .btn { padding:6px 14px; margin:0 6px; border:1px solid #aaa; border-radius:6px; background:#f0f3f7; cursor:pointer; }
    .btn:hover { background:#e4e8ed; }
  </style>
</head>
<body>
  <h1>ğŸ“– å°æµ‹è¯•</h1>
  <p class="tip">æ ¹æ®ä¸­æ–‡æç¤ºè¾“å…¥å¯¹åº”çš„ä¿„è¯­ <span class="pill">åœ¨è¾“å…¥æ¡†é‡Œç©ºæ ¼=è¾“å…¥ç©ºæ ¼</span> <span class="pill">æ•´æ®µæ­£ç¡®å ç©ºæ ¼/å›è½¦=ç­”æ¡ˆ/ä¸‹ä¸€é¢˜</span></p>

  <div id="card" class="card">
    <div id="cn" style="font-size:18px; margin-bottom:8px;"></div>
    <input id="wordInput" type="text" class="word-input" placeholder="è¾“å…¥ä¿„è¯­è¯ / è¯ç»„ / å¥å­â€¦" autocomplete="off" />
    <div id="status" class="muted"></div>
    <div class="controls">
      <button class="btn" onclick="toggleSpeak()">ğŸ”Š æš‚åœ/ç»§ç»­æœ—è¯»</button>
    </div>
  </div>

  <div id="answer" class="answer-box" style="display:none;">
    <div id="ru" class="ru"></div>
    <div id="phon" class="phon"></div>
    <div id="pos" class="pos"></div>
    <div id="cnAnswer" class="cn"></div>
  </div>

  <script>
  // ====== æ•°æ® ======
  const cards = [
    {
      cn: "æ¬¢è¿æ‚¨æ¥æˆ‘ä»¬å…¬å¸ï¼",
      ru: "ĞœÑ‹ Ñ€Ğ°Ğ´Ñ‹ Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ²Ğ°Ñ Ğ² Ğ½Ğ°ÑˆĞµĞ¹ ĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¸!",
      parts: [
        { ru: "ĞœÑ‹", cn: "æˆ‘ä»¬", pos: "ä»£è¯",   phon: "ĞœÑ‹" },
        { ru: "Ñ€Ğ°Ğ´Ñ‹", cn: "é«˜å…´", pos: "å½¢å®¹è¯", phon: "Ñ€Ğ°ÌĞ´Ñ‹" },
        { ru: "Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ²Ğ°Ñ", cn: "æ¬¢è¿æ‚¨", pos: "åŠ¨è¯è¯ç»„", phon: "Ğ¿Ñ€Ğ¸Ğ²ĞµÌÑ‚ÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ²Ğ°Ñ" },
        { ru: "Ğ² Ğ½Ğ°ÑˆĞµĞ¹ ĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¸", cn: "åœ¨æˆ‘ä»¬å…¬å¸", pos: "ä»‹è¯çŸ­è¯­", phon: "Ğ² Ğ½Ğ°ÌÑˆĞµĞ¹ ĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ˜Ğ¸" },
        { ru: "ĞœÑ‹ Ñ€Ğ°Ğ´Ñ‹ Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ²Ğ°Ñ Ğ² Ğ½Ğ°ÑˆĞµĞ¹ ĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¸", cn: "æ¬¢è¿æ‚¨æ¥æˆ‘ä»¬å…¬å¸", pos: "å®Œæ•´å¥å­", phon: "ĞœÑ‹ Ñ€Ğ°ÌĞ´Ñ‹ Ğ¿Ñ€Ğ¸Ğ²ĞµÌÑ‚ÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ²Ğ°Ñ Ñ„ Ğ½Ğ°ÌÑˆÑƒ ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ˜Ñ!" }
      ]
    }
  ];

  let currentCard = 0;
  let currentPart = 0;
  let showingAnswer = false;

  // ====== æ‰“å­—æœºéŸ³æ•ˆ ======
  const keyAudio = new Audio("https://actions.google.com/sounds/v1/office/typewriter.ogg");
  keyAudio.volume = 0.5; // å¯ä»¥è°ƒéŸ³é‡

  function clickSound() {
    keyAudio.currentTime = 0;  // æ¯æ¬¡ä»å¤´æ’­æ”¾
    keyAudio.play();
  }

  // ====== å·¥å…· ======
  function normalize(str) {
    return str
      .toLowerCase()
      .replace(/[.,!?;:â€”â€“â€¦Â«Â»"()]/g, "")
      .replace(/\s+/g, " ")
      .trim();
  }
  function expected() { return cards[currentCard].parts[currentPart].ru; }
  function isCompleteInput() {
    const val = document.getElementById('wordInput').value;
    return normalize(val) === normalize(expected());
  }

  // ====== ä¿„è¯­æœ—è¯» ======
  let speaking = false;
  let loopTimer = null;
  function speak(text) {
    stopSpeak();
    const u = new SpeechSynthesisUtterance(text);
    u.lang = "ru-RU";
    u.rate = 0.75;
    u.onend = () => {
      if (speaking) loopTimer = setTimeout(() => speak(text), 1000);
    };
    speechSynthesis.speak(u);
  }
  function stopSpeak() {
    clearTimeout(loopTimer);
    speechSynthesis.cancel();
  }
  function toggleSpeak() {
    if (speaking) { speaking = false; stopSpeak(); }
    else { speaking = true; speak(expected()); }
  }

  // ====== æ¸²æŸ“ ======
  function renderPart() {
    const part = cards[currentCard].parts[currentPart];
    document.getElementById('cn').innerText = "ä¸­æ–‡æç¤ºï¼š " + part.cn;
    const inp = document.getElementById('wordInput');
    const status = document.getElementById('status');
    const answerBox = document.getElementById('answer');

    inp.value = "";
    inp.classList.remove('correct','wrong');
    answerBox.style.display = "none";
    showingAnswer = false;
    status.textContent = `ç›®æ ‡ï¼š${part.pos}`;

    inp.focus();
    let lastLen = 0;
    inp.onkeydown = (e) => {
      if (e.key.length === 1 || e.key === 'Backspace' || e.key === ' ') clickSound();
    };
    inp.oninput = (e) => {
      if (e.target.value.length > lastLen) clickSound();
      lastLen = e.target.value.length;
    };

    speaking = true;
    speak(part.ru);
  }

  // ====== ç­”æ¡ˆé¡µ ======
  function showAnswer() {
    const part = cards[currentCard].parts[currentPart];
    const inp = document.getElementById('wordInput');
    const answerBox = document.getElementById('answer');

    inp.classList.remove('correct','wrong');
    if (isCompleteInput()) inp.classList.add('correct');
    else inp.classList.add('wrong');

    document.getElementById('ru').textContent   = part.ru;
    document.getElementById('phon').textContent = "é‡éŸ³ï¼š" + part.phon;
    document.getElementById('pos').textContent  = "è¯æ€§ï¼š" + part.pos;
    document.getElementById('cnAnswer').textContent = "ä¸­æ–‡ï¼š" + part.cn;

    answerBox.style.display = "block";
    showingAnswer = true;
  }

  function nextPage() {
    currentPart++;
    if (currentPart >= cards[currentCard].parts.length) currentPart = 0;
    renderPart();
  }

  // ====== å…¨å±€é”®ç›˜ï¼šç©ºæ ¼/å›è½¦ ======
  document.addEventListener('keydown', (e) => {
    const inp = document.getElementById('wordInput');
    if (!inp) return;
    const targetIsInput = document.activeElement === inp;

    if (e.key === ' ' || e.key === 'Enter') {
      const complete = isCompleteInput();

      if (targetIsInput && !complete) {
        if (e.key === ' ') return;
        if (e.key === 'Enter') { e.preventDefault(); return; }
      }

      e.preventDefault();
      if (!showingAnswer) showAnswer(); else nextPage();
    }
  });

  // ====== åˆå§‹åŒ– ======
  renderPart();
  </script>
</body>
</html>
