<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>小测试</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 30px; background: #f4f6f9; color:#222; }
    h1 { color: #2a2a2a; margin-bottom: 12px; }
    .card { border: 1px solid #ccc; padding: 20px; margin: 20px auto; width: 92%; max-width: 960px;
            border-radius: 12px; background: #fff; box-shadow: 0 4px 12px rgba(0,0,0,.06); }
    .word-row { display:flex; flex-wrap:wrap; justify-content:center; gap:10px; }
    .word-block { display:flex; align-items:center; }
    .word-input { width: 150px; padding: 8px 10px; font-size: 18px; text-align: center;
                  border: 1px solid #d0d7de; border-radius: 8px; outline: none; }
    .word-input:focus { box-shadow: 0 0 0 3px rgba(51,136,255,.18); border-color: #3388ff; }
    .punct { font-size:20px; font-weight:700; margin-left:4px; color:#444; }
    .correct { background: #c8f7c5; border: 1px solid #47a447 !important; }
    .wrong { background: #f8d7da; border: 1px solid #f44336 !important; color: #b00020; font-weight: bold; }
    .answer-box { margin: 18px auto 0; padding: 16px; border-radius: 10px; background: #eef3fc; width:92%; max-width: 960px;
                  box-shadow: inset 0 0 6px rgba(0,0,0,0.06); text-align:left; }
    .answer-box .row { margin:6px 0; }
    .label { display:inline-block; min-width:92px; color:#555; }
    .ru { font-size: 22px; font-weight: 700; color: #003366; }
    .btn { padding:10px 18px; margin:8px; border:1px solid #aaa; border-radius:8px; background:#f0f3f7; cursor:pointer; font-size:18px; }
    .btn:hover { background:#e6ebf2; }
    .muted { color:#666; font-size:14px; margin:10px 0 18px; }
    .mobile-only { display:inline-block; }
  </style>
</head>
<body>
  <h1>📖 小测试</h1>
  <p class="muted">
    操作：输入单词后按空格/回车判定；完成一页后 → 再按空格显示答案；再次空格进入下一页。<br>
    回退：在输入框按 <b>Backspace</b>（光标在最前或为空）可返回上一个单词。<br>
    朗读：电脑端输入后自动朗读（除非暂停）；手机/平板需点击🔊。<br>
    跳过：点击➡️下一页即可直接看答案或跳转。
  </p>

  <div class="card">
    <div id="cn" style="font-size:18px; margin-bottom:12px;"></div>
    <div id="inputs" class="word-row"></div>
    <div class="controls" style="margin-top:8px;">
      <button class="btn" id="speakBtn">🔊 播放/暂停</button>
      <button class="btn mobile-only" id="nextBtn">➡️ 下一页</button>
    </div>
  </div>

  <div id="answer" class="answer-box" style="display:none;">
    <div class="row"><span class="label">俄语：</span><span id="ru" class="ru"></span></div>
    <div class="row"><span class="label">重音：</span><span id="phon"></span></div>
    <div class="row"><span class="label">词性/语法：</span><span id="pos"></span></div>
    <div class="row"><span class="label">中文：</span><span id="cnAnswer"></span></div>
  </div>

  <script>
  const pages = [
    // 句1
    { cn:"液压分配器（第一格）", ru:"Гидрораспределитель", phon:"Гидрораспредели́тель", pos:"名词 · 第一格" },
    { cn:"用于（短尾形）", ru:"предназначен", phon:"предназна́чен", pos:"短尾形" },
    { cn:"用于控制（介词+二格）", ru:"для управления", phon:"для управле́ния", pos:"介词词组" },
    { cn:"流动（第一格）", ru:"поток", phon:"пото́к", pos:"名词 · 第一格" },
    { cn:"本句形式：流动（工具格复数）", ru:"потоками", phon:"пото́ками", pos:"名词 · 工具格复数" },
    { cn:"工作（阳性第一格）", ru:"рабочий", phon:"рабо́чий", pos:"形容词 · 阳性第一格" },
    { cn:"本句形式：工作的（阴性二格单数）", ru:"рабочей", phon:"рабо́чей", pos:"形容词 · 阴性二格单数" },
    { cn:"液体（第一格）", ru:"жидкость", phon:"жи́дкость", pos:"名词 · 第一格 阴" },
    { cn:"本句形式：液体（二格单数）", ru:"жидкости", phon:"жи́дкости", pos:"名词 · 二格单数 阴" },
    { cn:"液压系统（第一格）", ru:"гидросистема", phon:"гидросисте́ма", pos:"名词 · 第一格 阴" },
    { cn:"本句形式：液压系统（前置格单数）", ru:"гидросистеме", phon:"гидросисте́ме", pos:"名词 · 前置格单数 阴" },
    { cn:"整句：液压分配器用于控制液压系统中工作液体的流动。", 
      ru:"Гидрораспределитель предназначен для управления потоками рабочей жидкости в гидросистеме.",
      phon:"Гидрораспредели́тель предназна́чен для управле́ния пото́ками рабо́чей жи́дкости в гидросисте́ме.",
      pos:"句子" },

    // 句2
    { cn:"它（第一格）", ru:"он", phon:"он", pos:"代词 · 第一格" },
    { cn:"由…组成（不定式）", ru:"состоять", phon:"состоя́ть", pos:"动词 · 不定式" },
    { cn:"本句形式：由…组成（3单）", ru:"состоит", phon:"состои́т", pos:"动词 · 3单" },
    { cn:"几个（数量词·词典形）", ru:"несколько", phon:"не́сколько", pos:"数量词 · 基本形" },
    { cn:"本句形式：几个（属格复数）", ru:"нескольких", phon:"не́скольких", pos:"数量词 · 属格复数" },
    { cn:"阀片（第一格）", ru:"секция", phon:"се́кция", pos:"名词 · 第一格 阴" },
    { cn:"本句形式：阀片（二格复数）", ru:"секций", phon:"се́кций", pos:"名词 · 二格复数 阴" },
    { cn:"每一个（阳性第一格）", ru:"каждый", phon:"ка́ждый", pos:"代词 · 阳性第一格" },
    { cn:"本句形式：每一个（阴性第一格）", ru:"каждая", phon:"ка́ждая", pos:"代词 · 阴性第一格" },
    { cn:"负责（不定式）", ru:"отвечать", phon:"отвеча́ть", pos:"动词 · 不定式" },
    { cn:"本句形式：负责（3单）", ru:"отвечает", phon:"отвеча́ет", pos:"动词 · 3单" },
    { cn:"独立的（阳性第一格）", ru:"отдельный", phon:"отде́льный", pos:"形容词 · 阳性第一格" },
    { cn:"执行的（阳性第一格）", ru:"исполнительный", phon:"исполни́тельный", pos:"形容词 · 阳性第一格" },
    { cn:"执行机构（第一格）", ru:"механизм", phon:"механи́зм", pos:"名词 · 第一格 阳" },
    { cn:"整句：它由若干阀片组成，每一个阀片负责一个执行机构。", 
      ru:"Он состоит из нескольких секций, каждая из которых отвечает за отдельный исполнительный механизм.",
      phon:"Он состои́т из не́скольких се́кций, ка́ждая из кото́рых отвеча́ет за отде́льный исполни́тельный механи́зм.",
      pos:"句子" }
  ];

  // === 下面逻辑同前版，只加了“下一页按钮允许随时跳过” ===
  let idx=0, showingAnswer=false, pageComplete=false;
  let ruVoice=null, speaking=false, audioUnlocked=false, loopTimer=null;
  const isMobile=/Mobi|Android|iPad|iPhone/i.test(navigator.userAgent);

  function pickRuVoice(){const v=speechSynthesis.getVoices();ruVoice=v.find(x=>x.lang.toLowerCase().startsWith('ru'))||null;}
  pickRuVoice();speechSynthesis.onvoiceschanged=pickRuVoice;

  function stopSpeak(){clearTimeout(loopTimer);speechSynthesis.cancel();}
  function speak(text){if(!audioUnlocked||!speaking)return;stopSpeak();const u=new SpeechSynthesisUtterance(text);
    if(ruVoice)u.voice=ruVoice;u.lang="ru-RU";u.rate=0.85;u.onend=()=>{if(speaking&&!isMobile)loopTimer=setTimeout(()=>speak(text),1500)};speechSynthesis.speak(u);}

  let audioCtx;function ensureAudioCtx(){if(!audioCtx){const AC=window.AudioContext||window.webkitAudioContext;audioCtx=new AC();}if(audioCtx.state==='suspended')audioCtx.resume();}
  function keyClick(){ensureAudioCtx();const osc=audioCtx.createOscillator();const gain=audioCtx.createGain();osc.type="square";
    osc.frequency.setValueAtTime(2500,audioCtx.currentTime);gain.gain.setValueAtTime(0.03,audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+0.04);osc.connect(gain).connect(audioCtx.destination);
    osc.start();osc.stop(audioCtx.currentTime+0.04);}

  function normalize(s){return(s||"").toLowerCase().replace(/[.,!?;:—–…«»"()]/g,"");}
  function recomputePageComplete(){const inputs=document.querySelectorAll('#inputs input.word-input');pageComplete=Array.from(inputs).every(i=>i.classList.contains('done'));}

  function renderPage(){stopSpeak();showingAnswer=false;pageComplete=false;document.getElementById('answer').style.display='none';
    const {cn,ru}=pages[idx];document.getElementById('cn').textContent="中文提示："+cn;const inputsDiv=document.getElementById('inputs');inputsDiv.innerHTML="";
    const tokenRegex=/^(.+?)([.,!?;:—–…«»"()]*)$/;const tokens=ru.trim().split(/\s+/);
    tokens.forEach((w)=>{const block=document.createElement("div");block.className="word-block";const inp=document.createElement("input");inp.type="text";inp.className="word-input";
      let base=w,punct="";const m=w.match(tokenRegex);if(m){base=m[1];punct=m[2];}inp.dataset.correct=base;
      inp.addEventListener('input',()=>{keyClick();if(!audioUnlocked){audioUnlocked=true;}if(!isMobile&&!speaking){speaking=true;speak(ru);}
        if(inp.classList.contains('done')){const ok=normalize(inp.value)===normalize(inp.dataset.correct);inp.classList.toggle('correct',ok);inp.classList.toggle('wrong',!ok);}});
      inp.addEventListener('keydown',(e)=>{if(e.key.length===1)keyClick();
        if(e.key==='Backspace'){const atStart=(inp.selectionStart===0&&inp.selectionEnd===0);if(atStart||inp.value===''){e.preventDefault();
          const all=Array.from(document.querySelectorAll('#inputs input.word-input'));const idxPrev=all.indexOf(inp)-1;if(idxPrev>=0){const prev=all[idxPrev];
            prev.classList.remove('done','correct','wrong');prev.focus();const v=prev.value;prev.value='';prev.value=v;recomputePageComplete();}return;}}
        if(e.key===' '||e.key==='Enter'){e.preventDefault();const ok=normalize(inp.value)===normalize(inp.dataset.correct);
          inp.classList.add('done');inp.classList.toggle('correct',ok);inp.classList.toggle('wrong',!ok);
          const next=Array.from(document.querySelectorAll('#inputs input.word-input')).find(x=>!x.classList.contains('done'));if(next){next.focus();}
          recomputePageComplete();}});
      block.appendChild(inp);if(punct){const span=document.createElement("span");span.className="punct";span.textContent=punct;block.appendChild(span);}inputsDiv.appendChild(block);});
    if(!isMobile&&audioUnlocked&&speaking)speak(ru);const first=inputsDiv.querySelector('input.word-input');if(first)first.focus();}

  function showAnswer(){const p=pages[idx];document.getElementById('ru').textContent=p.ru;document.getElementById('phon').textContent=p.phon||"";
    document.getElementById('pos').textContent=p.pos||"";document.getElementById('cnAnswer').textContent=p.cn||"";document.getElementById('answer').style.display='block';showingAnswer=true;}
  function nextPage(){idx=(idx+1)%pages.length;renderPage();}
  document.addEventListener('keydown',(e)=>{if(e.key===' '||e.key==='Enter'){if(!showingAnswer&&pageComplete){e.preventDefault();showAnswer();}
    else if(showingAnswer){e.preventDefault();nextPage();}}});
  document.getElementById('speakBtn').onclick=()=>{if(!audioUnlocked){audioUnlocked=true;}if(speaking){speaking=false;stopSpeak();}else{speaking=true;speak(pages[idx].ru);}};
  document.getElementById('nextBtn').onclick=()=>{if(!showingAnswer){showAnswer();}else{nextPage();}};
  renderPage();
  </script>
</body>
</html>