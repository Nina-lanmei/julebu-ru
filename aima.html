<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>å°æµ‹è¯•</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 40px; background: #f4f6f9; }
    h1 { color: #333; }
    .card { border: 1px solid #ccc; padding: 20px; margin: 20px auto; width: 90%; max-width: 960px;
            border-radius: 12px; background: #fff; box-shadow: 0 4px 10px rgba(0,0,0,.08); }
    .word-row { display:flex; flex-wrap:wrap; justify-content:center; gap:8px; }
    .word-input { width: 140px; padding: 8px; font-size: 18px; text-align: center;
                  border: 1px solid #d0d7de; border-radius: 6px; }
    .word-input:focus { box-shadow: 0 0 0 3px rgba(51,136,255,.18); border-color: #3388ff; }
    .correct { background: #c8f7c5; border: 1px solid #4caf50 !important; }
    .wrong { background: #f8d7da; border: 1px solid #f44336 !important; color: #b00020; font-weight: bold; }
    .answer-box { margin-top: 16px; padding: 18px; border-radius: 10px; background: #eef3fc;
                  box-shadow: inset 0 0 6px rgba(0,0,0,0.06); }
    .ru { font-size: 22px; font-weight: 700; color: #003366; }
    .phon, .pos, .cn { font-size: 18px; color: #333; margin-top: 6px; }
    .btn { padding:6px 14px; margin:0 6px; border:1px solid #aaa; border-radius:6px; background:#f0f3f7; cursor:pointer; }
    .btn:hover { background:#e4e8ed; }
  </style>
</head>
<body>
  <h1>ğŸ“– å°æµ‹è¯•</h1>
  <p>é€è¯è¾“å…¥ â†’ æ­£ç¡®=ç»¿è‰²ï¼Œé”™è¯¯=çº¢è‰²ã€‚<br>
     å¡«å®Œæœ€åä¸€ä¸ªå•è¯å â†’ æ˜¾ç¤ºç­”æ¡ˆï¼Œå†æŒ‰ä¸€æ¬¡ç©ºæ ¼/å›è½¦ â†’ ä¸‹ä¸€é¡µã€‚<br>
     ğŸ“± æ‰‹æœºç”¨æˆ·è¯·å…ˆç‚¹ä¸€æ¬¡ ğŸ”Š æŒ‰é’®è§£é”è¯­éŸ³ã€‚</p>

  <div id="card" class="card">
    <div id="cn" style="font-size:18px; margin-bottom:12px;"></div>
    <div id="inputs" class="word-row"></div>
    <div class="controls">
      <button class="btn" onclick="toggleSpeak()">ğŸ”Š æš‚åœ/ç»§ç»­æœ—è¯»</button>
    </div>
  </div>

  <div id="answer" class="answer-box" style="display:none;">
    <div id="ru" class="ru"></div>
    <div id="phon" class="phon"></div>
    <div id="pos" class="pos"></div>
    <div id="cnAnswer" class="cn"></div>
  </div>

  <script>
  // ====== åŸå§‹æ•°æ®ï¼ˆå®Œæ•´ï¼‰======
  const cards = [
    {
      cn: "é‡è¦çš„æ˜¯ï¼Œä¸“ç”¨åº•ç›˜çš„ä½¿ç”¨å…è®¸åœ¨å…¬å…±é“è·¯ä¸Šè¡Œé©¶ï¼Œæ— éœ€è®¸å¯å’Œé¢å¤–è´¹ç”¨ï¼Œè½´è·ä¸º9+15å¨ã€‚",
      ru: "Ğ’Ğ°Ğ¶Ğ½Ğ¾, Ñ‡Ñ‚Ğ¾ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ ÑĞ¿ĞµÑ†ÑˆĞ°ÑÑĞ¸ Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚ Ğ¿ĞµÑ€ĞµĞ´Ğ²Ğ¸Ğ³Ğ°Ñ‚ÑŒÑÑ Ğ¿Ğ¾ Ğ´Ğ¾Ñ€Ğ¾Ğ³Ğ°Ğ¼ Ğ¾Ğ±Ñ‰ĞµĞ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ±ĞµĞ· Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ğ¸ Ğ´Ğ¾Ğ¿Ğ»Ğ°Ñ‚ â€“ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ½Ğ° Ğ¾ÑĞ¸ ÑĞ¾ÑÑ‚Ğ°Ğ²Ğ»ÑÑÑ‚ 9,0 + 15,0 Ñ‚.",
      parts: [
        { ru: "Ğ’Ğ°Ğ¶Ğ½Ğ¾", cn: "é‡è¦", pos: "Ğ½Ğ°Ñ€ĞµÑ‡Ğ¸Ğµ", phon: "Ğ’Ğ°ÌĞ¶Ğ½Ğ¾" },
        { ru: "Ñ‡Ñ‚Ğ¾ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ ÑĞ¿ĞµÑ†ÑˆĞ°ÑÑĞ¸", cn: "ä¸“ç”¨åº•ç›˜çš„ä½¿ç”¨", pos: "ÑÑƒÑ‰. + Ğ¿Ñ€Ğ¸Ğ».", phon: "Ñ‡Ñ‚Ğ¾ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµÌĞ½Ğ¸Ğµ ÑĞ¿ĞµÌÑ†ÑˆĞ°ÑÑĞ¸" },
        { ru: "Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚ Ğ¿ĞµÑ€ĞµĞ´Ğ²Ğ¸Ğ³Ğ°Ñ‚ÑŒÑÑ", cn: "å…è®¸ç§»åŠ¨", pos: "Ğ³Ğ»Ğ°Ğ³Ğ¾Ğ»", phon: "Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ»ÑÌĞµÑ‚ Ğ¿ĞµÑ€ĞµĞ´Ğ²Ğ¸Ğ³Ğ°ÌÑ‚ÑŒÑÑ" },
        { ru: "Ğ¿Ğ¾ Ğ´Ğ¾Ñ€Ğ¾Ğ³Ğ°Ğ¼ Ğ¾Ğ±Ñ‰ĞµĞ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ", cn: "åœ¨å…¬å…±é“è·¯ä¸Š", pos: "ÑÑƒÑ‰. + Ğ¿Ñ€Ğ¸Ğ».", phon: "Ğ¿Ğ¾ Ğ´Ğ¾Ñ€Ğ¾ÌĞ³Ğ°Ğ¼ Ğ¾ÌĞ±Ñ‰ĞµĞ³Ğ¾ Ğ¿Ğ¾ÌĞ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ" },
        { ru: "Ğ±ĞµĞ· Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ğ¸ Ğ´Ğ¾Ğ¿Ğ»Ğ°Ñ‚", cn: "æ— éœ€è®¸å¯å’Œé¢å¤–è´¹ç”¨", pos: "ÑÑƒÑ‰. + Ğ¿Ñ€Ğ¸Ğ».", phon: "Ğ±ĞµĞ· Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞ¸ÌÑ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ´Ğ¾ĞºÑƒĞ¼ĞµÌĞ½Ñ‚Ğ¾Ğ² Ğ¸ Ğ´Ğ¾Ğ¿Ğ»Ğ°ÌÑ‚" },
        { ru: "Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ½Ğ° Ğ¾ÑĞ¸ ÑĞ¾ÑÑ‚Ğ°Ğ²Ğ»ÑÑÑ‚ 9,0 + 15,0 Ñ‚.", cn: "è½´è·ä¸º9+15å¨", pos: "ÑÑƒÑ‰. + Ñ‡Ğ¸ÑĞ».", phon: "Ğ½Ğ°Ğ³Ñ€ÑƒÌĞ·ĞºĞ¸ Ğ½Ğ° Ğ¾ÌÑĞ¸ ÑĞ¾ÑÑ‚Ğ°Ğ²Ğ»ÑÌÑÑ‚" },
        { ru: "æ•´å¥", cn: "æ•´å¥", pos: "Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ", phon: "Ğ’Ğ°ÌĞ¶Ğ½Ğ¾, Ñ‡Ñ‚Ğ¾ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµÌĞ½Ğ¸Ğµ ÑĞ¿ĞµÌÑ†ÑˆĞ°ÑÑĞ¸ Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ»ÑÌĞµÑ‚..." }
      ]
    },
    {
      cn: "åœ¨ä¸“é—¨å‡†å¤‡çš„åœºåœ°ä¸Šï¼Œèµ·é‡æœºå¯ä»¥å¸¦å…¨å¥—é…é‡ç§»åŠ¨ã€‚",
      ru: "ĞŸĞ¾ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾ Ğ¿Ğ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğ¼ Ğ¿Ğ»Ğ¾Ñ‰Ğ°Ğ´ĞºĞ°Ğ¼ ĞºÑ€Ğ°Ğ½ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¿ĞµÑ€ĞµĞ¼ĞµÑ‰Ğ°Ñ‚ÑŒÑÑ Ñ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¼ Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ¼ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ¿Ñ€Ğ¾Ñ‚Ğ¸Ğ²Ğ¾Ğ²ĞµÑĞ¾Ğ².",
      parts: [
        { ru: "ĞŸĞ¾ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾ Ğ¿Ğ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğ¼ Ğ¿Ğ»Ğ¾Ñ‰Ğ°Ğ´ĞºĞ°Ğ¼", cn: "åœ¨ä¸“é—¨å‡†å¤‡çš„åœºåœ°ä¸Š", pos: "ÑÑƒÑ‰. + Ğ¿Ñ€Ğ¸Ğ».", phon: "ĞŸĞ¾ ÑĞ¿ĞµÑ†Ğ¸Ğ°ÌĞ»ÑŒĞ½Ğ¾ Ğ¿Ğ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾ÌĞ²Ğ»ĞµĞ½Ğ½Ñ‹Ğ¼ Ğ¿Ğ»Ğ¾Ñ‰Ğ°Ğ´ĞºĞ°ÌĞ¼" },
        { ru: "ĞºÑ€Ğ°Ğ½ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¿ĞµÑ€ĞµĞ¼ĞµÑ‰Ğ°Ñ‚ÑŒÑÑ", cn: "èµ·é‡æœºå¯ä»¥ç§»åŠ¨", pos: "Ğ³Ğ»Ğ°Ğ³Ğ¾Ğ»", phon: "ĞºÑ€Ğ°Ğ½ Ğ¼Ğ¾ÌĞ¶ĞµÑ‚ Ğ¿ĞµÑ€ĞµĞ¼ĞµÑ‰Ğ°ÌÑ‚ÑŒÑÑ" },
        { ru: "Ñ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¼ Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ¼ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ¿Ñ€Ğ¾Ñ‚Ğ¸Ğ²Ğ¾Ğ²ĞµÑĞ¾Ğ²", cn: "å¸¦å…¨å¥—é…é‡", pos: "ÑÑƒÑ‰. + Ğ¿Ñ€Ğ¸Ğ».", phon: "Ñ Ğ¿Ğ¾ÌĞ»Ğ½Ñ‹Ğ¼ Ğ¿Ğ°ĞºĞµÌÑ‚Ğ¾Ğ¼ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ˜Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ¿Ñ€Ğ¾Ñ‚Ğ¸Ğ²Ğ¾Ğ²ĞµÌÑĞ¾Ğ²" },
        { ru: "æ•´å¥", cn: "æ•´å¥", pos: "Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ", phon: "ĞŸĞ¾ ÑĞ¿ĞµÑ†Ğ¸Ğ°ÌĞ»ÑŒĞ½Ğ¾ Ğ¿Ğ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾ÌĞ²Ğ»ĞµĞ½Ğ½Ñ‹Ğ¼ ..." }
      ]
    }
  ];

  let currentCard = 0;
  let currentPart = 0;
  let firstPage = true;
  let hasAudioUnlock = false;
  let showingAnswer = false;

  // ====== å·¥å…· ======
  function normalize(str) {
    return str.toLowerCase().replace(/[.,!?;:â€”â€“â€¦Â«Â»"()]/g, "").trim();
  }

  // ====== æ‰“å­—æœºéŸ³æ•ˆ ======
  let audioCtx;
  function ensureAudioCtx() {
    if (!audioCtx) {
      const AC = window.AudioContext || window.webkitAudioContext;
      audioCtx = new AC();
    }
    if (audioCtx.state === 'suspended') audioCtx.resume();
  }
  function typewriterClick() {
    ensureAudioCtx();
    const now = audioCtx.currentTime;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = "square";
    osc.frequency.setValueAtTime(1500, now);
    gain.gain.setValueAtTime(0.1, now);
    gain.gain.exponentialRampToValueAtTime(0.001, now + 0.05);
    osc.connect(gain).connect(audioCtx.destination);
    osc.start(now);
    osc.stop(now + 0.05);
  }

  // ====== è¯­éŸ³ ======
  let speaking = false;
  let loopTimer = null;
  function speak(text) {
    stopSpeak();
    const u = new SpeechSynthesisUtterance(text);
    u.lang = "ru-RU";
    u.rate = 0.8;
    u.onend = () => { if (speaking) loopTimer = setTimeout(() => speak(text), 900); };
    speechSynthesis.speak(u);
  }
  function stopSpeak() { clearTimeout(loopTimer); speechSynthesis.cancel(); }
  function toggleSpeak() {
    const text = cards[currentCard].parts[currentPart].ru;
    hasAudioUnlock = true;
    if (speaking) { speaking = false; stopSpeak(); }
    else { speaking = true; speak(text); }
  }

  // ====== æ¸²æŸ“ ======
  function renderPart() {
    stopSpeak(); speaking = false;
    const part = cards[currentCard].parts[currentPart];
    document.getElementById("cn").innerText = "ä¸­æ–‡æç¤ºï¼š" + part.cn;
    const inputsDiv = document.getElementById("inputs");
    inputsDiv.innerHTML = "";
    document.getElementById("answer").style.display = "none";
    showingAnswer = false;

    const tokens = part.ru.split(/\s+/);
    tokens.forEach((tok, i) => {
      const inp = document.createElement("input");
      inp.type = "text";
      inp.className = "word-input";
      inp.dataset.correct = tok;

      // å³æ—¶åˆ¤å®š
      inp.addEventListener("input", () => {
        typewriterClick();
        if (normalize(inp.value) === normalize(tok)) {
          inp.classList.remove("wrong");
          inp.classList.add("correct");
          inp.disabled = true;
          const next = inputsDiv.querySelectorAll("input")[i+1];
          if (next) next.focus();
          else showAnswer();
        }
      });

      inp.addEventListener("keydown", (e) => {
        if (e.key === " " || e.key === "Enter") {
          e.preventDefault(); e.stopPropagation();
          if (normalize(inp.value) !== normalize(tok)) inp.classList.add("wrong");
          const next = inputsDiv.querySelectorAll("input")[i+1];
          if (next) next.focus();
          else showAnswer();
        }
      });

      inputsDiv.appendChild(inp);
    });

    const first = inputsDiv.querySelector("input");
    if (first) first.focus();

    // è‡ªåŠ¨æœ—è¯»é€»è¾‘
    if (!firstPage && hasAudioUnlock) {
      speaking = true;
      speak(part.ru);
    }
    firstPage = false;
  }

  function showAnswer() {
    const part = cards[currentCard].parts[currentPart];
    document.getElementById("ru").textContent = part.ru;
    document.getElementById("phon").textContent = "é‡éŸ³ï¼š" + part.phon;
    document.getElementById("pos").textContent = "è¯æ€§ï¼š" + part.pos;
    document.getElementById("cnAnswer").textContent = "ä¸­æ–‡ï¼š" + part.cn;
    document.getElementById("answer").style.display = "block";
    showingAnswer = true;
  }

  function nextPage() {
    currentPart++;
    if (currentPart >= cards[currentCard].parts.length) {
      currentCard = (currentCard+1) % cards.length;
      currentPart = 0;
    }
    renderPart();
  }

  document.addEventListener("keydown", e => {
    if ((e.key === " " || e.key === "Enter") && showingAnswer) {
      e.preventDefault();
      nextPage();
    }
  });

  renderPart();
  </script>
</body>
</html>