<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>å°æµ‹è¯•</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 40px; }
    .card { border: 1px solid #ccc; padding: 20px; margin: 20px auto; width: 85%; border-radius: 10px; background: #f9f9f9; }
    .word-block { display: inline-flex; align-items: center; margin: 5px; }
    .word-input { width: 120px; padding: 8px; font-size: 16px; text-align: center; }
    .punct { font-size: 18px; font-weight: bold; margin-left: 3px; }
    .correct { background: #c8f7c5; border: 1px solid #4caf50; }
    .wrong { background: #f8d7da; border: 1px solid #f44336; }
    .ru { font-size: 20px; font-weight: bold; color: #003366; margin-top: 10px; }
    .phon { font-size: 16px; color: #555; }
  </style>
</head>
<body>

<h1>ğŸ“– å°æµ‹è¯•</h1>
<p>è¯·æ ¹æ®ä¸­æ–‡ï¼ŒæŠŠä¿„è¯­å¥å­é€è¯è¾“å…¥ï¼ˆæ ‡ç‚¹åªæ˜¾ç¤ºï¼Œä¸éœ€è¦è¾“å…¥ï¼›ç‚¹å‡»ç¬¬ä¸€ä¸ªè¾“å…¥æ¡†å°†å¼€å§‹å¾ªç¯æœ—è¯»ï¼‰ï¼š</p>

<div id="card" class="card">
  <div id="cn"></div>
  <div id="inputs"></div>
</div>

<div id="feedback"></div>
<div id="answer" style="display:none;">
  <div id="ru" class="ru"></div>
  <div id="phon" class="phon"></div>
</div>

<script>
// å¥å­å¡ç‰‡ï¼ˆå·²ä¿®æ­£ ĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¸ï¼‰
const cards = [
  {
    cn: "æ¬¢è¿æ‚¨æ¥æˆ‘ä»¬å…¬å¸ï¼",
    ru: "ĞœÑ‹ Ñ€Ğ°Ğ´Ñ‹ Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ²Ğ°Ñ Ğ² Ğ½Ğ°ÑˆĞµĞ¹ ĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¸!",
    phon: "ĞœÑ‹ Ñ€Ğ°ÌĞ´Ñ‹ Ğ¿Ñ€Ğ¸Ğ²ĞµÌÑ‚ÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ²Ğ°Ñ Ñ„ Ğ½Ğ°ÌÑˆÑƒ ĞºĞ°Ğ¼Ğ¿Ğ°Ğ½Ğ˜Ñ!"
  },
  {
    cn: "æ‚¨ä¸€è·¯è¾›è‹¦äº†ã€‚",
    ru: "ĞĞ°Ğ´ĞµÑÑÑŒ, Ğ´Ğ¾Ñ€Ğ¾Ğ³Ğ° Ğ½Ğµ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ ÑƒÑ‚Ğ¾Ğ¼Ğ¸Ğ»Ğ° Ğ²Ğ°Ñ.",
    phon: "ĞĞ°Ğ´Ğ•ÑÑÑŒ, Ğ´Ğ°Ñ€ĞĞ³Ğ° Ğ½Ğµ ÑĞ»Ğ˜ÑˆĞºĞ°Ğ¼ ÑƒÑ‚Ğ°Ğ¼Ğ˜Ğ»Ğ° Ğ²Ğ°Ñ"
  },
  {
    cn: "éœ€è¦å–ç‚¹æ°´æˆ–è€…å’–å•¡å—ï¼Ÿ",
    ru: "ĞœĞ¾Ğ³Ñƒ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ÑŒ Ğ²Ğ°Ğ¼ Ğ²Ğ¾Ğ´Ñƒ, Ñ‡Ğ°Ğ¹ Ğ¸Ğ»Ğ¸ ĞºĞ¾Ñ„Ğµ.",
    phon: "ĞœĞ°Ğ³Ğ£ Ğ¿Ñ€ĞµĞ´Ğ»Ğ°Ğ¶Ğ˜Ñ‚ÑŒ Ğ²Ğ°Ğ¼ Ğ²ĞĞ´Ñƒ, Ñ‡Ğ°Ğ¹ Ğ¸Ğ»Ê² ĞºĞÑ„Ğµ"
  }
];

let currentIndex = 0;
let words = [];
let allCorrect = false;
let isSpeaking = false;

// â€”â€” å·¥å…·å‡½æ•° â€”â€”
// åˆ¤å®šæ—¶å¿½ç•¥å¤§å°å†™ä¸å¸¸è§æ ‡ç‚¹ï¼ˆå«ç ´æŠ˜å·ã€çœç•¥å·ä¸å¼•å·ï¼‰
function normalize(str) {
  return str
    .toLowerCase()
    .replace(/[.,!?;:â€”â€“â€¦Â«Â»"()]/g, "");
}

function stopSpeaking() {
  speechSynthesis.cancel();
}

function speakLoop(text) {
  stopSpeaking();
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = "ru-RU";
  utter.rate = 0.7; // 0.7å€é€Ÿ
  utter.onend = () => { if (isSpeaking) speakLoop(text); };
  speechSynthesis.speak(utter);
}

// â€”â€” æ˜¾ç¤ºä¸­æ–‡å¹¶ç”Ÿæˆè¾“å…¥æ¡† â€”â€”
// æ›´ç¨³å¥çš„åˆ†è¯ï¼šæŒ‰ä»»æ„ç©ºç™½åˆ‡åˆ†
function showChinese() {
  const card = cards[currentIndex];
  document.getElementById("cn").innerText = card.cn;
  document.getElementById("feedback").innerText = "";
  document.getElementById("answer").style.display = "none";
  stopSpeaking();
  isSpeaking = false;
  allCorrect = false;

  // åˆ†ç¦»è¯å°¾æ ‡ç‚¹ï¼šæŠŠæ¯ä¸ªâ€œè¯+æ ‡ç‚¹â€æ‹†ä¸º base + punct
  // æ”¯æŒå¤šä¸ªæ ‡ç‚¹å åŠ ï¼Œæ¯”å¦‚ "ĞºĞ¾Ñ„Ğµ...?!"
  const tokenRegex = /^(.+?)([.,!?;:â€”â€“â€¦Â«Â»"()]*)$/;
  words = card.ru.trim().split(/\s+/).map(w => {
    const m = w.match(tokenRegex);
    return { base: m ? m[1] : w, punct: m ? m[2] : "" };
  });

  const inputsDiv = document.getElementById("inputs");
  inputsDiv.innerHTML = "";

  words.forEach((w, i) => {
    const block = document.createElement("div");
    block.className = "word-block";

    const inp = document.createElement("input");
    inp.type = "text";
    inp.className = "word-input";
    inp.disabled = i !== 0;
    inp.dataset.correct = w.base;

    // ç‚¹å‡»ç¬¬ä¸€ä¸ªè¾“å…¥æ¡†æ—¶å¼€å§‹å¾ªç¯æœ—è¯»
    if (i === 0) {
      inp.addEventListener("focus", () => {
        if (!isSpeaking) { isSpeaking = true; speakLoop(card.ru); }
      });
    }

    inp.addEventListener("input", (e) => checkWord(e, inp, i));

    block.appendChild(inp);

    if (w.punct) {
      const span = document.createElement("span");
      span.className = "punct";
      span.innerText = w.punct;
      block.appendChild(span);
    }

    inputsDiv.appendChild(block);
  });
}

// â€”â€” å•è¯åˆ¤å®š â€”â€”
// æ­£ç¡®ï¼šå½“å‰æ¡†å˜ç»¿å¹¶é”å®šï¼Œè‡ªåŠ¨èšç„¦åˆ°ä¸‹ä¸€ä¸ªï¼›å…¨å¯¹åæ˜¾ç¤ºç­”æ¡ˆ
function checkWord(e, inp, index) {
  const val = normalize(e.target.value);
  const correct = normalize(inp.dataset.correct);

  if (val === correct) {
    inp.classList.remove("wrong");
    inp.classList.add("correct");
    inp.disabled = true;

    const inputs = document.querySelectorAll(".word-input");
    if (index + 1 < inputs.length) {
      const next = inputs[index + 1];
      next.disabled = false;
      next.focus();
    } else {
      allCorrect = true;
      showAnswer();
    }
  } else {
    inp.classList.add("wrong");
  }
}

// â€”â€” æ˜¾ç¤ºç­”æ¡ˆ â€”â€” 
function showAnswer() {
  const card = cards[currentIndex];
  document.getElementById("answer").style.display = "block";
  document.getElementById("ru").innerText = card.ru;
  document.getElementById("phon").innerText = card.phon;
}

// â€”â€” åˆ‡æ¢ä¸‹ä¸€å¥ â€”â€” 
function nextSentence() {
  currentIndex = (currentIndex + 1) % cards.length;
  showChinese();
}

// å…¨éƒ¨æ­£ç¡®åï¼šå›è½¦ / ç©ºæ ¼ è·³ä¸‹ä¸€å¥
document.addEventListener("keydown", (e) => {
  if (allCorrect && (e.key === "Enter" || e.key === " ")) {
    nextSentence();
  }
});

// åˆå§‹åŒ–
showChinese();
</script>

</body>
</html>